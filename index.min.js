'use strict';var _typeof='function'==typeof Symbol&&'symbol'==typeof Symbol.iterator?function(a){return typeof a}:function(a){return a&&'function'==typeof Symbol&&a.constructor===Symbol&&a!==Symbol.prototype?'symbol':typeof a},_createClass=function(){function a(a,b){for(var c,d=0;d<b.length;d++)c=b[d],c.enumerable=c.enumerable||!1,c.configurable=!0,'value'in c&&(c.writable=!0),Object.defineProperty(a,c.key,c)}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}();function _classCallCheck(a,b){if(!(a instanceof b))throw new TypeError('Cannot call a class as a function')}String.prototype.repeat=String.prototype.repeat||function(a){return 1>=a?this:this+this.repeat(a-1)};function padLeft(a,b,c){return b.repeat(Math.max(0,c-a.length))+a}var Sequencer=function(){function a(b){_classCallCheck(this,a);if(this.config=Object.assign({},{canvas:null,from:'',to:'',scaleMode:'cover',hiDPI:!0},b),b.hasOwnProperty('retina')&&(this.config.hiDPI=b.retina),''==this.config.from&&''==this.config.to)return console.error('Missing filenames.'),!1;if(!this.config.canvas)return console.error('Missing canvas node.'),!1;this.current=-1,this.images=[],this.lastLoaded=-1,this.ctx=this.config.canvas.getContext('2d');var c=this.parseSequence(this.config.from,this.config.to);this.fileList=a.buildFileList(c),this.size(this.ctx.canvas.width,this.ctx.canvas.height),this.load()}var b=Math.min,c=Math.abs;return _createClass(a,[{key:'load',value:function a(){this.load=function(){console.log('load() can be called only once.')},this.preloader(this.images,this.fileList,this.config.imageLoad,this.config.queueComplete)}},{key:'nextImage',value:function a(){this.drawImage(++this.current)}},{key:'prevImage',value:function a(){this.drawImage(--this.current)}},{key:'scrollDrawImage',value:function f(a){for(var b=this,d=a-this.current,e=0;e<c(d);e++)requestAnimationFrame(function(){0<d?b.nextImage():b.prevImage()})}},{key:'drawImage',value:function l(a){if(void 0===a&&(a=this.current),!(0>a||a>=this.images.length)){var b=this.config.hiDPI?window.devicePixelRatio:1,c=this.ctx.canvas.width/b,d=this.ctx.canvas.height/b,e=c/d,f=this.images[a],g=f.width/f.height,h=void 0,i=void 0;'cover'==this.config.scaleMode?e>g?(h=c,i=h/g):(i=d,h=i*g):'contain'==this.config.scaleMode?e<g?(h=c,i=h/g):(i=d,h=i*g):(h=f.width,i=f.height);var j=c/2-h/2,k=d/2-i/2;this.ctx.save(),this.ctx.scale(b,b),this.ctx.clearRect(0,0,c,d),this.ctx.drawImage(f,0,0,f.width,f.height,~~j,~~k,~~h,~~i),this.ctx.restore()}}},{key:'size',value:function c(a,b){var d=this.config.hiDPI?window.devicePixelRatio:1,e=this.ctx.canvas;e.width=a*d,e.height=b*d,e.style.width=a+'px',e.style.height=b+'px',this.drawImage()}},{key:'parseSequence',value:function n(d,e){function f(a){return Math.log(a)/Math.LN10}for(var g=Math.floor,h=b(d.length,e.length),j=Math.max(0,d.lastIndexOf('/'));d.charAt(j)==e.charAt(j)&&!/[1-9]/.test(d.charAt(j))&&j<h;)j++;var k=d.slice(j,d.lastIndexOf('.')),a=e.slice(j,e.lastIndexOf('.')),l=parseInt(k),m=parseInt(a);return{from:l,to:m,base:d.substr(0,j),ext:d.substr(d.lastIndexOf('.')),zeroes:k.length==a.length&&g(f(l))<g(f(m))?k.length:0,length:c(m-l)+1}}},{key:'buildFileList',value:function g(a){for(var b=[],c=a.from>a.to?-1:1,d=0;d<a.length;d++){var e=(a.from+d*c).toString(),f=padLeft(e,'0',a.zeroes);b.push(a.base+f+a.ext)}return b}},{key:'preloader',value:function l(a,c,d,e){function f(){if(!(h>=c.length-1)){h++;var b=new Image;b.src=c[h],function(a){b.onload=function(){'function'==typeof d&&d({id:a,img:b,count:++j,total:c.length}),j<c.length&&f(),j==c.length&&'function'==typeof e&&e({total:c.length})},b.onerror=function(){console.error('Error with: '+c[a])}}(h),a.push(b)}}for(var g=b(c.length,4),h=a.length-1,j=a.length,k=0;k<g;k++)f()}}]),a}();(function(a,b){'function'==typeof define&&define.amd?define(['ScrollMagic'],b):'object'===('undefined'==typeof exports?'undefined':_typeof(exports))?b(require('scrollmagic')):b(a.ScrollMagic||a.jQuery&&a.jQuery.ScrollMagic)})(void 0,function(a){a.Scene.prototype.addImageSequencer=function(a){var b=this,c=new Sequencer(a);this.on('progress',function(){var a=Math.round(b.progress()*(c.images.length-1));c.scrollDrawImage(a)})}});
